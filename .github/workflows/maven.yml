name: Java Selenium Automation workflow with Maven

on: 
  schedule:
  - cron: 00 18 * * *
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven

  # -----------------------------
  # Install Chrome + Edge and Drivers
  # -----------------------------
    - name: Install Browsers and Drivers
      run: |
        # Install Google Chrome
          wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
          sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" > /etc/apt/sources.list.d/google-chrome.list'
          sudo apt update
          sudo apt install -y google-chrome-stable
          
          # Install ChromeDriver
          CHROME_VERSION=$(google-chrome --version | awk '{print $3}' | cut -d '.' -f 1)
          CHROMEDRIVER_VERSION=$(curl -sS "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROME_VERSION")
          wget -O /tmp/chromedriver.zip "https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip"
          unzip /tmp/chromedriver.zip -d $HOME
          export PATH=$HOME:$PATH
          
          # Install Microsoft Edge
          curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
          sudo install -o root -g root -m 644 microsoft.gpg /usr/share/keyrings/
          sudo sh -c 'echo "deb [arch=amd64 signed-by=/usr/share/keyrings/microsoft.gpg] https://packages.microsoft.com/repos/edge stable main" > /etc/apt/sources.list.d/microsoft-edge.list'
          sudo apt update
          sudo apt install -y microsoft-edge-stable
          
          # Install EdgeDriver
          EDGE_VERSION=$(microsoft-edge --version | awk '{print $3}' | cut -d '.' -f 1)
          wget -O /tmp/edgedriver.zip "https://msedgedriver.azureedge.net/LATEST_RELEASE_$EDGE_VERSION/edgedriver_linux64.zip"
          unzip /tmp/edgedriver.zip -d $HOME
          export PATH=$HOME:$PATH
          
          # Verify installations
          google-chrome --version
          chromedriver --version
          microsoft-edge --version
          msedgedriver --version
        
    - name: Running the tests with Maven
      run: mvn test -Dbrowser=edge -DisHeadLess=false -DisLambdaTest=false 

    - name: Upload logs of the test
      if: always()
      uses: actions/upload-artifact@v5.0.0
      with:
        name: Test Logs
        path: logs/

    - name: Upload Extent Test Report
      if: always()
      uses: actions/upload-artifact@v5.0.0
      with:
        name: Extent Reports
        path: ExtentReports/report.html

    - name: Test Execution Status
      run: echo "Test Execution Completed"
      

    
    


