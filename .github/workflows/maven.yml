name: Java Selenium Automation workflow with Maven

on: 
  schedule:
  - cron: 00 18 * * *
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven

    - name: Install Google Chrome
      run: |
        sudo apt update
        sudo apt install -y wget unzip xvfb libxi6 libgconf-2-4 default-jdk google-chrome-stable
        # Install latest ChromeDriver
        LATEST_CHROME=$(google-chrome --version | awk '{print $3}')
        echo "Chrome version: $LATEST_CHROME"
        LATEST_DRIVER=$(curl -sS https://chromedriver.storage.googleapis.com/LATEST_RELEASE)
        echo "ChromeDriver version: $LATEST_DRIVER"
        wget -O /tmp/chromedriver_linux64.zip "https://chromedriver.storage.googleapis.com/$LATEST_DRIVER/chromedriver_linux64.zip"
        unzip /tmp/chromedriver_linux64.zip -d $HOME
        chmod +x $HOME/chromedriver
        export PATH=$HOME:$PATH

    - name: Install Microsoft Edge + EdgeDriver
      run: |
        curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
        sudo install -o root -g root -m 644 microsoft.gpg /etc/apt/trusted.gpg.d/
        sudo sh -c 'echo "deb [arch=amd64] https://packages.microsoft.com/repos/edge stable main" > /etc/apt/sources.list.d/microsoft-edge.list'
        sudo apt update
        sudo apt install -y microsoft-edge-stable
        EDGE_VERSION=$(microsoft-edge --version | awk '{print $3}')
        echo "Edge version: $EDGE_VERSION"
        wget -O /tmp/edgedriver.zip "https://msedgedriver.azureedge.net/$EDGE_VERSION/edgedriver_linux64.zip"
        unzip /tmp/edgedriver.zip -d $HOME
        chmod +x $HOME/msedgedriver
        export PATH=$HOME:$PATH
          
          # Verify installations
          google-chrome --version
          chromedriver --version
          microsoft-edge --version
          msedgedriver --version
        
    - name: Running the tests with Maven
      run: mvn test -Dbrowser=edge -DisHeadLess=false -DisLambdaTest=false 

    - name: Upload logs of the test
      if: always()
      uses: actions/upload-artifact@v5.0.0
      with:
        name: Test Logs
        path: logs/

    - name: Upload Extent Test Report
      if: always()
      uses: actions/upload-artifact@v5.0.0
      with:
        name: Extent Reports
        path: ExtentReports/report.html

    - name: Test Execution Status
      run: echo "Test Execution Completed"
      

    
    


