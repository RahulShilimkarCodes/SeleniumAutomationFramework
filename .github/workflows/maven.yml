name: Java Selenium Automation workflow with Maven

on: 
  schedule:
  - cron: 00 18 * * *
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven

    # Install required dependencies for Chrome and Edge
    - name: Install Browsers and Dependencies
      run: |
        sudo apt update
        sudo apt install -y wget unzip curl xvfb fonts-liberation libxss1 libappindicator3-1 libatk-bridge2.0-0 libgtk-3-0

        # Install Chrome
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo gpg --dearmor -o /usr/share/keyrings/google-linux-signing-key.gpg
        echo "deb [signed-by=/usr/share/keyrings/google-linux-signing-key.gpg] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
        sudo apt update
        sudo apt install -y google-chrome-stable

        # Install Edge
        curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
        sudo install -o root -g root -m 644 microsoft.gpg /etc/apt/trusted.gpg.d/
        sudo sh -c 'echo "deb [arch=amd64] https://packages.microsoft.com/repos/edge stable main" > /etc/apt/sources.list.d/microsoft-edge.list'
        sudo apt update
        sudo apt install -y microsoft-edge-stable

    # Install ChromeDriver (match with installed Chrome version)
    - name: Install ChromeDriver
      run: |
        CHROME_VERSION=$(google-chrome --version | awk '{print $3}' | cut -d '.' -f 1)
        wget -O /tmp/chromedriver.zip "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROME_VERSION"
        wget -O /tmp/chromedriver.zip "https://chromedriver.storage.googleapis.com/$CHROME_VERSION/chromedriver_linux64.zip"
        unzip /tmp/chromedriver.zip -d /usr/local/bin/
        chmod +x /usr/local/bin/chromedriver

    # Install EdgeDriver (latest stable)
    - name: Install EdgeDriver
      run: |
        EDGE_VERSION=$(microsoft-edge --version | awk '{print $3}')
        EDGE_MAJOR=$(echo $EDGE_VERSION | cut -d '.' -f1)
        wget -O /tmp/edgedriver.zip "https://msedgedriver.azureedge.net/$EDGE_VERSION/edgedriver_linux64.zip"
        unzip /tmp/edgedriver.zip -d /usr/local/bin/
        chmod +x /usr/local/bin/msedgedriver

        
    - name: Running the tests with Maven
      run: mvn test -Dbrowser=edge -DisHeadLess=false -DisLambdaTest=false 

    - name: Upload logs of the test
      if: always()
      uses: actions/upload-artifact@v5.0.0
      with:
        name: Test Logs
        path: logs/

    - name: Upload Extent Test Report
      if: always()
      uses: actions/upload-artifact@v5.0.0
      with:
        name: Extent Reports
        path: ExtentReports/report.html

    - name: Test Execution Status
      run: echo "Test Execution Completed"
      

    
    


